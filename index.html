<!DOCTYPE html>
<html>
<head>
  <title>GPS Tracker</title>
</head>
<body>
  <h2>Test Firestore GPS</h2>
  <button onclick="saveLocation()">Save Location</button>

  <script type="module">
    // Import Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // üî¥ ‡πÉ‡∏™‡πà config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.saveLocation = function () {
      navigator.geolocation.getCurrentPosition(async (position) => {
        const lat = position.coords.latitude;
        const lng = position.coords.longitude;

        await addDoc(collection(db, "locations"), {
          latitude: lat,
          longitude: lng,
          timestamp: serverTimestamp()
        });

        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß");
      });
    };
  </script>
  <!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<!-- ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà -->
<div id="map" style="height: 500px; width: 100%; margin-top:20px;"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  const firebaseConfig = {
     apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_STORAGE_BUCKET",
  messagingSenderId: "YOUR_MESSAGING_ID",
  appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

async function loadMap() {
  const querySnapshot = await getDocs(collection(db, "locations"));

  let firstLocation = null;

  querySnapshot.forEach((doc) => {
    const data = doc.data();
    if (!firstLocation) {
      firstLocation = data;
    }
  });

  if (!firstLocation) return;

  const map = L.map('map').setView(
    [firstLocation.latitude, firstLocation.longitude], 
    15
  );

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  querySnapshot.forEach((doc) => {
    const data = doc.data();
    L.marker([data.latitude, data.longitude])
      .addTo(map)
      .bindPopup("‡∏û‡∏¥‡∏Å‡∏±‡∏î: " + data.latitude + ", " + data.longitude);
  });
}

loadMap();
</script>

</body>
</html>
